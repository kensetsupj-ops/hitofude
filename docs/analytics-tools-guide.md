# 分析ツール使い方ガイド

このドキュメントでは、ひとふでに実装されている3つの分析・監視ツールの使い方を説明します。

## 📊 実装済みツール一覧

| ツール | 用途 | URL |
|--------|------|-----|
| Google Analytics (GA4) | アクセス解析 | https://analytics.google.com/ |
| Microsoft Clarity | ユーザー行動分析 | https://clarity.microsoft.com/ |
| Sentry | エラー監視 | https://sentry.io/ |

---

## 1️⃣ Google Analytics (GA4) - アクセス解析

### 📌 何ができるか

- サイト訪問者数の確認
- どのページが見られているか
- ユーザーの滞在時間
- 流入元（Google検索、SNS、直接アクセスなど）
- リアルタイムアクセス状況
- コンバージョン追跡

### 🔗 アクセス方法

https://analytics.google.com/

### 📊 主な見るべき画面

#### 1. ホーム - 全体サマリー
- 過去7日間のユーザー数
- 主要な指標（エンゲージメント、セッション数など）
- 日別のトレンドグラフ

#### 2. レポート → リアルタイム
- **今まさに**サイトを見ているユーザー数
- どのページを見ているか
- どこの国・地域からアクセスしているか

**活用例：**
- 新機能リリース直後の反応確認
- キャンペーン効果のリアルタイム測定

#### 3. レポート → エンゲージメント → ページとスクリーン
- 人気ページランキング
- ページごとの閲覧数・滞在時間
- 離脱率

**活用例：**
- どのページが人気か把握
- 滞在時間が短いページを改善

#### 4. レポート → 集客 → トラフィック獲得
- ユーザーがどこから来たか
  - Organic Search（Google検索など）
  - Direct（直接アクセス）
  - Referral（他サイトからのリンク）
  - Social（SNS）

**活用例：**
- SEO効果の測定
- SNS施策の効果確認

### 💡 活用方法

#### 毎日チェック（5分）
```
1. ホーム画面で昨日の訪問者数を確認
2. リアルタイムで現在の状況を確認
```

#### 週次チェック（15分）
```
1. エンゲージメント → ページとスクリーン
   → 先週の人気ページTOP5を確認
2. 集客 → トラフィック獲得
   → どの流入元が増えているか確認
3. 改善点をメモ
```

---

## 2️⃣ Microsoft Clarity - ヒートマップ・セッションリプレイ

### 📌 何ができるか

- **ユーザーの実際の操作を録画再生**（最強機能！）
- どこをクリックしているかのヒートマップ
- どこまでスクロールしているか
- 離脱ポイントの特定
- エラーやフラストレーションの自動検出
  - デッドクリック（機能しないボタンをクリック）
  - 怒りのクリック（連続クリック）
  - エラークリック

### 🔗 アクセス方法

https://clarity.microsoft.com/

### 📊 主な見るべき画面

#### 1. ダッシュボード
表示される指標：
- セッション数
- デッドクリック数
- 怒りのクリック数
- ページ速度
- JavaScriptエラー数

#### 2. レコーディング（録画）★最重要
- 実際のユーザー操作を**動画で再生**
- ユーザーがどう迷ったかが一目瞭然
- マウスの動き、クリック、スクロールすべて記録
- スキップ機能で重要な場面だけ確認可能

**おすすめのフィルター：**
```
✅ デッドクリック > 0
✅ 怒りのクリック > 0
✅ セッション時間 > 30秒

→ 問題のあるセッションだけに絞り込める！
```

**見方のコツ：**
1. 左側のサムネイルから気になるセッションを選択
2. 再生速度を2倍速に設定（右上の設定）
3. デッドクリック・怒りのクリックが発生した箇所に自動ジャンプ
4. 問題箇所をスクリーンショットしてメモ

#### 3. ヒートマップ
- **クリックヒートマップ**：どこがクリックされたか
- **スクロールヒートマップ**：どこまで読まれたか

**見方：**
```
1. ヒートマップタブを開く
2. ページURLを選択（例：/tools/delivery-guide）
3. デバイス別に確認（PC・モバイル）
```

### 💡 活用方法

#### 週次チェック（20-30分）推奨

```
【ステップ1】ダッシュボードで全体把握（5分）
- デッドクリック・怒りのクリックの数を確認
- どのページで多いかチェック

【ステップ2】問題のあるセッションを確認（15分）
1. レコーディングタブを開く
2. フィルター設定：
   - デッドクリック > 0
   - セッション時間 > 30秒
3. 3-5本の録画を見る
4. ユーザーが困っている箇所をメモ

【ステップ3】改善アクション決定（10分）
- メモした問題点を優先度付け
- 次週の改善項目を決定
```

#### こんな問題が見つかる例

```
❌ ユーザーが画像をクリックしようとしている
   → 画像にリンクがないことに気づいていない
   → 対策：画像にリンクを追加 or ボタンを目立たせる

❌ フォームの送信ボタンを何度もクリック
   → ボタンが反応しないと思われている
   → 対策：送信中の表示を追加

❌ 特定のページで即離脱
   → ページ内容が期待と違う
   → 対策：タイトル・説明文を改善
```

---

## 3️⃣ Sentry - エラー監視

### 📌 何ができるか

- JavaScript エラーの自動検出
- エラーが発生した環境（ブラウザ、OS、デバイス）の記録
- エラー発生時のユーザー操作履歴（breadcrumbs）
- エラーの影響を受けたユーザー数
- エラー発生頻度のトレンド
- **エラー通知**（メール・Slack連携可能）
- Session Replay（エラー発生時の画面録画）

### 🔗 アクセス方法

https://sentry.io/

### 📊 主な見るべき画面

#### 1. Issues（イシュー）★最重要
エラー一覧が表示されます：
- 各エラーの発生回数
- 影響を受けたユーザー数
- 最終発生日時
- エラーの優先度（High/Medium/Low）

**見方：**
```
1. Issuesタブを開く
2. 「Unresolved」でフィルター（未解決のみ）
3. 発生回数が多い順にソート
4. 上位のエラーから順に対処
```

#### 2. 個別のエラー詳細
各エラーをクリックすると詳細が見れます：
- エラーメッセージ
- **スタックトレース**（どのコードで起きたか）
- エラー発生箇所の行数
- ユーザーの操作履歴（breadcrumbs）
- ブラウザ・OS情報
- エラー発生時のURL

**デバッグのコツ：**
```
1. スタックトレースを確認
   → どの関数・ファイルで起きたか特定
2. Breadcrumbsを確認
   → ユーザーが何をしたらエラーが起きたか把握
3. 環境情報を確認
   → 特定のブラウザだけで起きているかチェック
```

#### 3. Performance（パフォーマンス）
- ページの読み込み速度
- 遅いAPI呼び出しの検出
- データベースクエリの遅延

#### 4. Session Replay（セッションリプレイ）
- **エラーが発生した時の画面録画**
- エラー前後のユーザー操作が見れる
- Microsoft Clarityとほぼ同じ機能

### 💡 活用方法

#### 毎日チェック（5分）推奨

```
【重要】エラーは放置厳禁！

1. Issuesタブを開く
2. 新しいエラーがないか確認
3. Highプライオリティのエラーをチェック
4. 緊急度の高いものはすぐ修正
```

#### エラー対応の優先順位

```
🔴 最優先（即日対応）
- 決済・フォーム送信などの重要機能のエラー
- 多くのユーザーに影響するエラー（発生回数が多い）

🟡 中優先（1週間以内）
- 特定の環境でのみ発生するエラー
- 一部機能のエラー

🟢 低優先（余裕があれば）
- 古いブラウザのみで発生
- ほとんど発生しないエラー
```

### 🔔 通知設定（推奨）

```
Settings → Alerts → Create Alert Rule

おすすめ設定：
✅ 新しいエラーが発生したら即座にメール通知
✅ エラー発生回数が10回を超えたら通知
✅ 週次サマリーメールを受け取る
```

---

## 📅 推奨チェックフロー

### 毎日（5-10分）

```
8:00 - Sentryでエラーチェック
- 新しいエラーの有無確認
- Highプライオリティのエラー対応

9:00 - Google Analyticsで昨日の数値確認
- 訪問者数の確認
- 異常値がないかチェック
```

### 毎週月曜（30-40分）

```
10:00 - Google Analytics 週次レビュー（15分）
1. 先週の訪問者数・トレンド確認
2. 人気ページTOP5確認
3. 流入元の変化をチェック
4. 気づいた点をメモ

10:15 - Microsoft Clarity ユーザー行動分析（20分）
1. ダッシュボードで全体把握
2. デッドクリック・怒りのクリックで絞り込み
3. 問題のあるセッション3-5本を視聴
4. UI改善のアイデア出し

10:35 - Sentry エラーレビュー（5分）
1. 先週のエラー発生傾向確認
2. 未解決エラーの対応計画
```

### 毎月1日（1時間）

```
月次レビュー

1. Google Analytics（30分）
   - 月間トレンド分析
   - 前月比較
   - 成長しているページ・減っているページの特定

2. Microsoft Clarity（20分）
   - 月間のデッドクリック・怒りのクリック集計
   - よく見られている録画TOP10を確認
   - UI改善の効果測定

3. Sentry（10分）
   - エラー発生率の推移
   - 解決したエラー・新規エラーの数
   - パフォーマンスの変化
```

---

## 💡 便利な活用テクニック

### Google Analytics

#### カスタムダッシュボード作成
```
左メニュー「探索」→ 新しい探索
→ よく見る指標を1画面にまとめられる

おすすめ指標：
- 日別訪問者数
- 人気ページTOP10
- 流入元の割合
- デバイス別訪問者数
```

#### イベント追跡
```
特定のボタンクリックを追跡したい場合：
1. タグマネージャーで設定 or コードに直接記述
2. エンゲージメント → イベント で確認
```

### Microsoft Clarity

#### おすすめフィルター組み合わせ

```
【モバイルユーザーの問題を探す】
- デバイス：モバイル
- 怒りのクリック > 0
→ スマホで使いづらい場所が分かる

【新規ユーザーの離脱原因を探る】
- セッション数：1（初訪問）
- セッション時間：< 30秒
→ すぐ離脱した理由を確認

【フォームの問題を探す】
- ページURL：/contact
- デッドクリック > 0
→ フォーム送信の問題を発見
```

#### ヒートマップの活用

```
【重要ページをチェック】
1. /tools/delivery-guide のヒートマップ
2. スクロール到達率を確認
   → 50%までしか読まれていない場合、
     重要な情報は上半分に配置すべき
```

### Sentry

#### エラーの優先度を自動判定

```
Settings → Issue Grouping
→ 同じエラーを自動でグルーピング

メリット：
- 同じエラーが何回起きたか自動集計
- 影響範囲が一目瞭然
```

#### Slack連携

```
Settings → Integrations → Slack
→ エラー発生時にSlackに通知

設定例：
- 新しいエラーが発生したら #alerts チャンネルに通知
- 即座に気づける
```

#### リリースの追跡

```
デプロイごとにバージョンを記録：
→ どのバージョンでエラーが増えたか分かる

設定方法：
sentry.init({
  release: "v1.0.1",  // バージョンを指定
})
```

---

## 🚨 よくある問題と対処法

### Google Analytics でデータが表示されない

```
原因：
1. 測定IDが間違っている
2. 広告ブロッカーが有効
3. JavaScriptが無効

対処法：
1. .env.localの NEXT_PUBLIC_GA_MEASUREMENT_ID を確認
2. シークレットモードでアクセスして確認
3. リアルタイムレポートで自分のアクセスが表示されるかテスト
```

### Microsoft Clarity で録画が見れない

```
原因：
1. プロジェクトIDが間違っている
2. データ収集に24時間かかる（初回のみ）

対処法：
1. .env.localの NEXT_PUBLIC_CLARITY_PROJECT_ID を確認
2. 初回は24時間待つ
3. 設定画面でステータスが「Active」か確認
```

### Sentry でエラーが記録されない

```
原因：
1. DSNが間違っている
2. サンプリングレートが低すぎる

対処法：
1. .env.localの NEXT_PUBLIC_SENTRY_DSN を確認
2. sentry.client.config.ts の tracesSampleRate を 1 に設定
3. わざとエラーを起こしてテスト
   例：throw new Error("Test error");
```

---

## 📚 参考リンク

### 公式ドキュメント
- [Google Analytics ヘルプ](https://support.google.com/analytics/)
- [Microsoft Clarity ドキュメント](https://learn.microsoft.com/ja-jp/clarity/)
- [Sentry Next.js ガイド](https://docs.sentry.io/platforms/javascript/guides/nextjs/)

### 学習リソース
- [GA4 の使い方（Google公式）](https://skillshop.withgoogle.com/)
- [Clarity 活用事例](https://clarity.microsoft.com/blog)

---

## ✅ チェックリスト

デイリー：
- [ ] Sentryで新規エラーをチェック
- [ ] Google Analyticsで昨日の訪問者数を確認

ウィークリー：
- [ ] Clarityで問題のあるセッション3-5本を視聴
- [ ] Google Analyticsで週次トレンドを確認
- [ ] 未解決のエラーを確認・対応計画

マンスリー：
- [ ] 月間レポート作成
- [ ] 改善施策の効果測定
- [ ] 次月の目標設定

---

**最終更新**: 2025-10-07
